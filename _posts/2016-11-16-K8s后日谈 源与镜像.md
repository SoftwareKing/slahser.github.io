![](https://o4dyfn0ef.qnssl.com/image/2016-11-15-kube7-logo.png?imageView2/2/h/200) 

我们在之前搭建了集群,可是rpm与镜像一直还是友情赞助.这让我很不安. 

 



私服证书/

/etc/docker/certs.d/registry.yourcompany.com

echo '192.168.6.15 registry.gogen.com' >> /etc/hosts

curl -k https://rexxxxxxx.com



https://packages.cloud.google.com/yum/repos/kubernetes-el7-x86_64/repodata/primary.xml

../../pool/04fc07d4526b18dbe8c5af04cc314fe9d837f864748d086d6cd9382fe1028638-kubeadm-1.5.0-1.alpha.2.380.85fe0f1aadf91e.0.x86_64.rpm

location
https://packages.cloud.google.com/yum/repos/kubernetes-el7-x86_64/../../pool/0f79053882493cac2acfb314e686540025094dea54d239e08d8f30a4b116e000-kubernetes-cni-0.3.0.1-1.07a8a2.x86_64.rpm

rpm -ivh

执行teardown

systemctl stop kubelet;
docker rm -f -v $(docker ps -q);
find /var/lib/kubelet | xargs -n 1 findmnt -n -t tmpfs -o TARGET -T | uniq | xargs -r umount -v;
rm -r -f /etc/kubernetes /var/lib/kubelet /var/lib/etcd;

也就是后来的kubectl reset

yum remove kubelet kubeadm kubectl kubernetes-cni

当random要留着之前的socat ebtables 干嘛的我也不知道. 



scp *.rpm  root@192.168.6.5[1:3]:/root

rpm -ivh *.rpm


/etc/systemd/system/kubelet.service.d/10-kubeadm.conf
/etc/kubernetes/manifests



还是systemctl enable kubelet
systemctl start kubectl
kubectl init 

查看/etc/kubernetes/manifests内版本

11个其中的四个

下载源码 checkout到对应tag
https://github.com/kubernetes/kubernetes

cmd/kubeadm/app/images/images.go

5个基础组件
etcd 2.2.5
KubeAPIServerImage:     1.4.4
KubeControllerManagerImage
KubeSchedulerImage: 
KubeProxyImage:

4个addon版本
kubeDNSVersion     = "1.7"
dnsmasqVersion     = "1.3"
exechealthzVersion = "1.1"
pauseVersion       = "3.0"

cmd/kubeadm/app/apis/kubeadm/env.go
discovery 1.0

最后一个dashboard就是跟着https://rawgit.com/kubernetes/dashboard/master/src/deploy/kubernetes-dashboard.yaml走了,实际也要考虑从一下changelog是不是有支持到. 

当然了,镜像下好以后我是置入私服的. 






