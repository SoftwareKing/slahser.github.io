我就感觉知道我现在的工作跟爬虫有关肯定有人会想知道标题这类东西...我先列个提纲每样慢慢写.. 

反屏蔽的东西很多人写过了...写一点我意淫时发散思考的东西.  

每块说起来做起来的量实际都不是很大,我真是很讨厌把一项技术说的难度爆表的人..  

> 算作占坑,把上一篇源码解读写完就写这个.. 

- - - - -- 

## 代理 

代理这部分相当一部分是蚂蚁的大兄弟的方案,不涉及保密协议又是我亲手去做的部分实在所剩无几...我简要写一下: 

### 代理机房 

使用`rp-pppoe`来进行拨号,使用`squid`进行正向代理.`jetty`做代理暴露服务容器.    

nginx的话配置代理https貌似挺麻烦的..过些日子会着手看一下. 

配好环境变量后做好服务,再写crontab定时看下squid与jetty是否挂掉. 

启动过程中通过读取配置文件虚拟出约定端口上的主机进行代理服务,另外留出端口进行服务调用. 

跑在代理机房机器上的应用暴露着线路拨号,状态查询等必须的服务.  

> 自建代理机房当然是出于安全性.也有着在代理速度方面的考虑.  

### 静态代理 

国外代理的机房自建难度相当的大,所以采取直接从服务商购买静态ip代理的形式. 

### 代理选取策略 

我休假后的第一个需求貌似就是反屏蔽中心的事儿. 

目前项目的代理选取策略还是写死的,面对不同目标网站有着首选与次选代理城市,二者皆挂则从虚拟机出去进行任务执行. 

之后的方案可能会考虑更动态化一些,可以穷举的目标站我们是不是能近实时的测速,这方面有得考虑,可以从代理机房服务出来,或者做到客户端应用中. 

当然了,首要的部分肯定要把代理相关都从客户端抽取出来,做成rpc或者rest服务.  

### 代理的心跳 

国内与国外都是我实现的,之前写出bug来了真是惭愧... 

关于线路可用状态的检测,比较理想的情况是我们直接拿目标页去访问,测速,记录在案... 

可是现实却由不得这么搞,费时费力效果还不明显. 

思路大抵是`curl -x`或者httpClient去访问body比较小的`目标近似页`(比如about页面).设好3个timeout,不断地扫列表里的代理. 

国内代理机房可以把这部分工作变成crontab,维护一个可用代理虚拟机sequence列表就行了,我们访问服务去请求回来更新状态,来决定下一步是重拨,告警抑或其他.  

海外代理的话则简单一点,这种粒度很小的task自然而然想到fork/join pool来搞一下,用了akka来实现,一个父Actor来负责所有代理状态的回收与监管策略.子Actor负责启动hc. 

> 这部分我试了下okHttp3发现设置代理的时候有些不乐观啊,遗憾. 

- - - - -- 

## UA/Header 

选取策略与Header里面到底能塞进去多少东西,能解决什么问题

- - - - -- 

## Cookie 

持久化为cookiejar

- - - - -- 

## JS渲染的代码 

使用无头浏览器(headless browser). 

![2016-06-09_Screen Shot 2016-06-09 at 06.14.46.png](https://o4dyfn0ef.qnssl.com/image/2016-06-09_Screen Shot 2016-06-09 at 06.14.46.png)

- - - - -- 

## Webkit & Selenium 

我们是不是需要Seleium与调用webkit的思考.  


