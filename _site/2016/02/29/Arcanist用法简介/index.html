<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Arcanist用法简介</title>
  <link rel="stylesheet" href="//fonts.useso.com/css?family=Source+Sans+Pro:300,300i,600">
  <link rel="stylesheet" href="/style.css">
  <!-- Begin Jekyll SEO tag v1.3.1 -->
<title>Arcanist用法简介 - Coup de Grace</title>
<meta property="og:title" content="Arcanist用法简介" />
<meta name="description" content="这是Phabricator配套的Code Review工具,需要配合本地clt使用." />
<meta property='og:description' content="这是Phabricator配套的Code Review工具,需要配合本地clt使用." />
<link rel="canonical" href="http://www.slahser.com/2016/02/29/Arcanist%E7%94%A8%E6%B3%95%E7%AE%80%E4%BB%8B/" />
<meta property='og:url' content='http://www.slahser.com/2016/02/29/Arcanist%E7%94%A8%E6%B3%95%E7%AE%80%E4%BB%8B/' />
<meta property="og:site_name" content="Coup de Grace" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2016-02-29T00:00:00+08:00" />
<link rel="next" href="http://www.slahser.com/2016/03/02/%E6%A0%91%E8%8E%93%E6%B4%BE%E4%B8%8A%E7%A1%AC%E4%BB%B6%E7%9B%91%E6%8E%A7-Cayenne/" title="树莓派上硬件监控 Cayenne" />
<link rel="prev" href="http://www.slahser.com/2016/02/27/%E5%85%B3%E4%BA%8EOSX%E7%9A%84QuickLook/" title="关于osx的quicklook" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="@S1ahs3r" />
<meta name="twitter:title" content="Arcanist用法简介 - Coup de Grace" />
<meta name="twitter:description" content="这是Phabricator配套的Code Review工具,需要配合本地clt使用." />
<meta name="twitter:creator" content="@S1ahs3r" />
<script type="application/ld+json">
  {
    "@context" : "http://schema.org",


    "@type" : "BlogPosting",

    "headline": "Arcanist用法简介",

    "datePublished": "2016-02-29T00:00:00+08:00",

    "description": "这是Phabricator配套的Code Review工具,需要配合本地clt使用.",


    "url" : "http://www.slahser.com/2016/02/29/Arcanist%E7%94%A8%E6%B3%95%E7%AE%80%E4%BB%8B/"
  }
</script>
<!-- End Jekyll SEO tag -->
  <!--baidu analysis-->
  <script>
    var _hmt = _hmt || [];
    (function() {
    var hm = document.createElement("script");
    hm.src = "//hm.baidu.com/hm.js?800b2d15920eea57fe7abcb3c52892f6";
    var s = document.getElementsByTagName("script")[0]; 
    s.parentNode.insertBefore(hm, s);
    })();
  </script>
</head>
<body>
  <div class="container">
    <header class="masthead">
  <h1 class="masthead-title--small">
    <a href="/">Coup de Grace</a>
  </h1>
</header>
<div class="content post">
  <h1 class="post-title">Arcanist用法简介</h1>
  <div class="post-date">
    <time>29 Feb 2016</time>
  </div>
  <p>这是Phabricator配套的Code Review工具,需要配合本地clt使用.</p>

<p>搜索引擎查了几回合实在不太好找到简洁明了的中文文档,姑且写一下.(这一套工具配起来真的挺糟心的…)</p>

<h3 id="section">安装</h3>
<p><del>第一种:</del></p>

<p><del>
brew tap homebrew/php
brew install arcanist
arc help
</del></p>

<p>第一种方法因为无法执行arc upgrade暂时舍弃.</p>

<p>第二种:</p>

<pre><code class="language-sj">brew install node
npm install -g arcanist
arc help
arc upgrade //Required

</code></pre>

<h3 id="section-1">注册</h3>

<p>执行<code class="highlighter-rouge">arc install-certificate http://[host].com:[port]</code></p>

<p>访问http://[host].com:[port]/conduit/token/<br />
或者http://[host].com:[port]/conduit/login/</p>

<p>遵照terminal提示访问地址(有的同事显示不一样,可能是机器cookie问题)</p>

<p>粘贴token进入terminal</p>

<p>done.</p>

<p><img src="http://7xqjx7.com1.z0.glb.clouddn.com/image/Screen%20Shot%202016-02-29%20at%2011.14.22.png?imageView2/2/h/600" alt="" /></p>

<p>本地配置文件所在位置<code class="highlighter-rouge">~/.arcrc</code></p>

<h3 id="section-2">配置</h3>

<p>设置用户默认配置<code class="highlighter-rouge">arc set-config default http://[host].com:[port]</code></p>

<p>正常的流程需要在项目根目录新建.arcconfig文件填入相应配置,JSON格式.
可选部分欢迎查看<a href="https://secure.phabricator.com/book/phabricator/article/arcanist/">这里</a></p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"phabricator.uri"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"http://[host].com:[port]"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"project_id"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"[ID]"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
</div>

<p>不添加这个而文件也可以,不过功能有很多限制:</p>

<p><img src="http://7xqjx7.com1.z0.glb.clouddn.com/image/Screen%20Shot%202016-02-29%20at%2014.41.38.png?imageView2/2/h/600" alt="" /></p>

<h3 id="section-3">流程</h3>

<blockquote>
  <p>本部分来自<a href="https://github.com/Hujiang-FE/arcanist">arcanist</a></p>
</blockquote>

<ol>
  <li><code class="highlighter-rouge">git checkout -b feature_xxx</code> — 创建一个新分支，并修改代码</li>
  <li><code class="highlighter-rouge">git add . &amp;&amp; git commit -m tt</code> — 将该提交的都提交上去</li>
  <li><code class="highlighter-rouge">arc diff [last_commit]</code>
    <ul>
      <li>此命令会将 last_commit 到最新的 commit 之间的改动的所有代码发送到 phabricator 平台，并创建一个 revision；</li>
      <li>如果没有指定 last_commit，则会使用 master 分支来作为 last_commit 的起点。</li>
      <li>运行命令后会弹出一个编辑面板，在此面板中你需要指定 reviewers，即指定一个或多个给你 review code 的人</li>
      <li>如果指定了多个 reviewers，则其中任何一个 review 通过就可以，不用全部 review 通过</li>
      <li>另外编辑面板中也有一个 test plan 选项，国外人一般每个项目都有测试，所以此项是必填的，如果没有测试，我们只需要随便设置一个字段即可，比如设置成 <code class="highlighter-rouge">no</code> 或 <code class="highlighter-rouge">skip</code></li>
      <li>如果觉得指派reviewer的用法不太方便,可以执行<code class="highlighter-rouge">arc diff --preview</code>根据生成的diff页面进入配置,生成revision.</li>
    </ul>
  </li>
  <li>以上操作之后，系统会发送邮件通知 reviewers 去 review 你的代码，你也可以通过 <code class="highlighter-rouge">arc list</code> 来查看当前 review 的状态</li>
  <li>后续
    <ul>
      <li>如果 review 没有通过，你需要在原来的基础上修改，修改完并 commit 之后需要执行 <code class="highlighter-rouge">arc diff [last_commit] --update D(id)</code> 继续 review</li>
      <li>如果 review 通过了，只需要运行 <code class="highlighter-rouge">arc land --onto some_branch</code>， arc 会将你当前分支合并到 master 上，并删除当前分支</li>
    </ul>
  </li>
</ol>

<blockquote>
  <p>更多详情可以查看<a href="https://phab.enlightenment.org/w/arcanist/">英文文档</a></p>
</blockquote>

</div>
  </div>
</body>
</html>
