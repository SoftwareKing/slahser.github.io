<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Mock server搭建</title>
  <link rel="stylesheet" href="//fonts.useso.com/css?family=Source+Sans+Pro:300,300i,600">
  <link rel="stylesheet" href="/style.css">
  <!-- Begin Jekyll SEO tag v1.3.1 -->
<title>Mock server搭建 - Coup de Grace</title>
<meta property="og:title" content="Mock server搭建" />
<meta name="description" content="前端项目的mock server改天介绍,今天写下基于moco的简易mock server搭建." />
<meta property='og:description' content="前端项目的mock server改天介绍,今天写下基于moco的简易mock server搭建." />
<link rel="canonical" href="http://www.slahser.com/2016/03/04/Mock-Server%E6%90%AD%E5%BB%BA/" />
<meta property='og:url' content='http://www.slahser.com/2016/03/04/Mock-Server%E6%90%AD%E5%BB%BA/' />
<meta property="og:site_name" content="Coup de Grace" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2016-03-04T00:00:00+08:00" />
<link rel="next" href="http://www.slahser.com/2016/03/07/%E5%86%99%E7%BB%99%E5%A4%A7%E5%AE%B6%E7%9C%8B%E7%9A%84%E8%AE%BE%E8%AE%A1%E4%B9%A6%E8%AF%BB%E5%90%8E/" title="写给大家看的设计书读后" />
<link rel="prev" href="http://www.slahser.com/2016/03/02/%E6%A0%91%E8%8E%93%E6%B4%BE%E4%B8%8A%E7%A1%AC%E4%BB%B6%E7%9B%91%E6%8E%A7-Cayenne/" title="树莓派上硬件监控 Cayenne" />
<meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="@S1ahs3r" />
<meta name="twitter:title" content="Mock server搭建 - Coup de Grace" />
<meta name="twitter:description" content="前端项目的mock server改天介绍,今天写下基于moco的简易mock server搭建." />
<meta name="twitter:creator" content="@S1ahs3r" />
<script type="application/ld+json">
  {
    "@context" : "http://schema.org",


    "@type" : "BlogPosting",

    "headline": "Mock server搭建",

    "datePublished": "2016-03-04T00:00:00+08:00",

    "description": "前端项目的mock server改天介绍,今天写下基于moco的简易mock server搭建.",


    "url" : "http://www.slahser.com/2016/03/04/Mock-Server%E6%90%AD%E5%BB%BA/"
  }
</script>
<!-- End Jekyll SEO tag -->
</head>
<body>
  <div class="container">
    <header class="masthead">
  <h1 class="masthead-title--small">
    <a href="/">Coup de Grace</a>
  </h1>
</header>
<div class="content post">
  <h1 class="post-title">Mock server搭建</h1>
  <div class="post-date">
    <time>04 Mar 2016</time>
  </div>
  <p>前端项目的mock server改天介绍,今天写下基于<a href="https://github.com/dreamhead/moco">moco</a>的简易mock server搭建.</p>

<p><img src="http://7xqjx7.com1.z0.glb.clouddn.com/image/Screen%20Shot%202016-03-06%20at%2012.10.33.png?imageView2/2/h/600" alt="" /></p>

<h3 id="intro">intro</h3>

<p>传统的mock server我们要写个war包放入容器中启动或者启动一个node server.每当发生改动还需要进行重启.</p>

<p>moco当初吸引我在github上点出star就是因为它的优点:</p>

<ul>
  <li>可繁可简,简易形式启动仅需启动一个jar包与一个配置文件</li>
  <li>热部署,修改配置文件无需重启应用,更新配置速度可观.</li>
</ul>

<h3 id="usage">usage</h3>

<p>简洁搭建如下:</p>

<ul>
  <li>OSX下可以 <code class="highlighter-rouge">brew install moco</code></li>
  <li>或者下载<a href="https://repo1.maven.org/maven2/com/github/dreamhead/moco-runner/0.10.2/moco-runner-0.10.2-standalone.jar">moco-runner-0.10.2-standalone.jar</a></li>
  <li>编写配置文件**.json置于某处(实例tt.json)</li>
</ul>

<p>文件中需要编写request/response对,具体配置项可以看<a href="https://github.com/dreamhead/moco/blob/master/moco-doc/apis.md">这里</a></p>

<p>示例内容(一个网站的手撕鬼子模拟):</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
        </span><span class="nt">"request"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"uri"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/system/resource/creategjjcheckimg.jsp"</span><span class="p">,</span><span class="w"> 
            </span><span class="nt">"queries"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="nt">"random"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2"</span><span class="w">
            </span><span class="p">}</span><span class="w">
        </span><span class="p">},</span><span class="w"> 
        </span><span class="nt">"response"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"status"</span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="p">,</span><span class="w"> 
            </span><span class="nt">"file"</span><span class="p">:</span><span class="w"> </span><span class="s2">"vc.png"</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">},</span><span class="w"> 
    </span><span class="p">{</span><span class="w">
        </span><span class="nt">"request"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"uri"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/gjjcx_dl.jsp"</span><span class="p">,</span><span class="w"> 
            </span><span class="nt">"queries"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="nt">"urltype"</span><span class="p">:</span><span class="w"> </span><span class="s2">"tree.TreeTempUrl"</span><span class="p">,</span><span class="w"> 
                </span><span class="nt">"wbtreeid"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1172"</span><span class="w">
            </span><span class="p">}</span><span class="w">
        </span><span class="p">},</span><span class="w"> 
        </span><span class="nt">"response"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"latency"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="nt">"duration"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> 
                </span><span class="nt">"unit"</span><span class="p">:</span><span class="w"> </span><span class="s2">"second"</span><span class="w">
            </span><span class="p">},</span><span class="w"> 
            </span><span class="nt">"status"</span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="p">,</span><span class="w"> 
            </span><span class="nt">"text"</span><span class="p">:</span><span class="w"> </span><span class="s2">"已登录"</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">},</span><span class="w"> 
    </span><span class="p">{</span><span class="w">
        </span><span class="nt">"request"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"uri"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/gjjcx_gjjxxcx.jsp"</span><span class="p">,</span><span class="w"> 
            </span><span class="nt">"queries"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="nt">"urltype"</span><span class="p">:</span><span class="w"> </span><span class="s2">"tree.TreeTempUrl"</span><span class="p">,</span><span class="w"> 
                </span><span class="nt">"wbtreeid"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1178"</span><span class="w">
            </span><span class="p">}</span><span class="w">
        </span><span class="p">},</span><span class="w"> 
        </span><span class="nt">"response"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"status"</span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="p">,</span><span class="w"> 
            </span><span class="nt">"file"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"xian1.response"</span><span class="p">,</span><span class="w"> 
                </span><span class="nt">"charset"</span><span class="p">:</span><span class="w"> </span><span class="s2">"UTF-8"</span><span class="w">
            </span><span class="p">}</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">},</span><span class="w"> 
    </span><span class="p">{</span><span class="w">
        </span><span class="nt">"request"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"uri"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/gjjcx_gjjmxcx.jsp"</span><span class="p">,</span><span class="w"> 
            </span><span class="nt">"queries"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="nt">"urltype"</span><span class="p">:</span><span class="w"> </span><span class="s2">"tree.TreeTempUrl"</span><span class="p">,</span><span class="w"> 
                </span><span class="nt">"wbtreeid"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1177"</span><span class="w">
            </span><span class="p">}</span><span class="w">
        </span><span class="p">},</span><span class="w"> 
        </span><span class="nt">"response"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"headers"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="nt">"content-type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"text/html"</span><span class="w">
            </span><span class="p">},</span><span class="w"> 
            </span><span class="nt">"status"</span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="p">,</span><span class="w"> 
            </span><span class="nt">"file"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"xian2.response"</span><span class="p">,</span><span class="w"> 
                </span><span class="nt">"charset"</span><span class="p">:</span><span class="w"> </span><span class="s2">"UTF-8"</span><span class="w">
            </span><span class="p">}</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span><span class="p">]</span><span class="w">  
</span></code></pre>
</div>

<ul>
  <li>放置非必要资源文件于统计目录,供request/response内容过大设置文件content或者返回attachment/image内容时使用.</li>
</ul>

<p>目录结构如图:
 <img src="http://7xqjx7.com1.z0.glb.clouddn.com/image/Screen%20Shot%202016-03-05%20at%2000.23.25.png?imageView2/2/h/600" alt="" /></p>

<ul>
  <li>
    <p>启动runner:</p>

    <p><code class="highlighter-rouge">java -jar moco-runner-&lt;version&gt;-standalone.jar http -p [port-like-9999] -c [json-path-like-tt.json]</code></p>
  </li>
</ul>

<blockquote>
  <p>配置后台运行,在上条命令后加上 &amp; 符号即可.
想在后台运行时打印日志,在上条命令后加上 nohup 即可.</p>
</blockquote>

<ul>
  <li>访问host:port/配置 路径进行访问.</li>
</ul>

<p>enjoy it!</p>

<p>for Sa6r1na.</p>

</div>
  </div>
</body>
</html>
